{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Listing</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        /* Your existing styles (unchanged) */
        body {
            background-color: #e3c8a2;
            font-family: 'Georgia', serif;
        }
        .navbar-custom { background-color: #d1a66d; }
        .navbar-custom .navbar-nav .nav-link { color: white; }
        .navbar-custom .navbar-nav .nav-link:hover { color: #fef1dd; }
        .navbar-profile { position: absolute; top: 15px; right: 15px; }
        .navbar-custom .search-bar { width: 70%; }
        .navbar-profile button { padding: 5px 15px; }
        .sidebar { background-color: #d1a66d; padding: 20px; border-radius: 10px; height: 100%; max-height: 90vh; overflow-y: auto; }
        .form-control, .form-select { background-color: #fef1dd; border: 1px solid #d9b27f; }
        .preview-box { background-color: #f7e1b5; border: 2px dashed #ba8c63; padding: 20px; border-radius: 15px; min-height: 400px; }
        .book-wall { background-image: url("{% static 'book-wall.jpg' %}"); background-size: cover; border-radius: 15px; }
        .nav-buttons { margin-top: 20px; text-align: center; }
        .nav-buttons .btn { margin: 0 10px; }
        .side-navigation { position: fixed; top: 60px; left: 0; background-color: #d1a66d; padding: 20px; height: 100%; width: 200px; border-radius: 10px; overflow-y: auto; }
        .side-navigation a { color: white; display: block; margin: 10px 0; text-decoration: none; }
        .side-navigation a:hover { color: #fef1dd; }
        .main-content { display: flex; flex-wrap: wrap; justify-content: space-between; padding: 20px; margin-left: 220px; }
        .sidebar-content { width: 30%; }
        .preview-content { width: 60%; }
        .preview-box, .sidebar-content, .preview-content { box-sizing: border-box; }
        .img-preview-container { width: 100%; height: 200px; object-fit: cover; background-color: #f7e1b5; border: 2px dashed #ba8c63; padding: 10px; border-radius: 15px; display: flex; justify-content: center; align-items: center; }
        .img-preview-container img { max-width: 100%; max-height: 100%; border-radius: 10px; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid">
            <a class="navbar-brand text-white" href="#">Shelf & Beyond</a>
            <div class="d-flex justify-content-between w-100">
                <form class="d-flex search-bar" role="search">
                    <input class="form-control" type="search" placeholder="Search by book name or author name" aria-label="Search">
                    <button class="btn btn-outline-light" type="submit">Search</button>
                </form>
                <div class="navbar-profile d-flex gap-2">
                    <a href="/profile" class="btn btn-outline-light">Profile</a>
                    <form action="{% url 'logout' %}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-light">Log out</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <!-- Side Navigation -->
    <div class="side-navigation">
        <a href="/browseall" class="btn btn-dark">Browse All</a>
        <a href="/notifications" class="btn btn-dark">Notifications</a>
        <a href="/message/show/" class="btn btn-dark">Inbox</a>
        <a href="/buying" class="btn btn-dark">Buying</a>
        <a href="/selling" class="btn btn-dark">Selling</a>
        <a href="/listing/create" class="btn btn-dark">Create Listing</a>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Sidebar (Create Form) -->
        <div class="sidebar-content">
            <h4>ðŸ“š Book for sale</h4>
            <form method="POST" enctype="multipart/form-data" id="listingForm" action="{% url 'create_listing' %}">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="{{ form.image.id_for_label }}" class="form-label">Upload Image</label>
                    {{ form.image }}
                </div>

                <div class="mb-3">
                    <label for="{{ form.title.id_for_label }}" class="form-label">Title</label>
                    {{ form.title }}
                </div>

                <div class="mb-3">
                    <label for="{{ form.author.id_for_label }}" class="form-label">Author name</label>
                    {{ form.author }}
                </div>

                <div class="mb-3">
                    <label for="{{ form.price.id_for_label }}" class="form-label">Price</label>
                    {{ form.price }}
                </div>

                <div class="mb-3">
                    <label for="{{ form.condition.id_for_label }}" class="form-label">Condition</label>
                    {{ form.condition }}
                </div>

                <div class="mb-3">
                    <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                    {{ form.description }}
                </div>

                <button type="submit" class="btn btn-dark mt-3">Add Listing</button>
            </form>
        </div>

        <!-- Preview Center -->
        <div class="preview-content">
            <div class="preview-box text-center">
                <h4>Your listing preview</h4>
                <p class="text-muted">As you create your listing, preview how it will appear to others</p>
                <div id="preview-content">
                    <div class="img-preview-container" id="img-preview">
                        <span>No image uploaded yet.</span>
                    </div>
                    <h5 id="preview-title"></h5>
                    <p id="preview-author"></p>
                    <p id="preview-description"></p>
                    <strong id="preview-price"></strong><br>
                    <em id="preview-condition"></em>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Live preview logic
        const titleField = document.getElementById('id_title');
        const priceField = document.getElementById('id_price');
        const authorField = document.getElementById('id_author');
        const conditionField = document.getElementById('id_condition');
        const descriptionField = document.getElementById('id_description');
        const imgPreview = document.getElementById('img-preview');
    
        function updatePreview() {
            document.getElementById('preview-title').textContent = titleField.value;
    
            document.getElementById('preview-description').textContent = descriptionField.value;

            document.getElementById('preview-author').textContent = authorField.value;
    
            document.getElementById('preview-price').textContent = priceField.value + ' BDT';
    
            document.getElementById('preview-condition').textContent = conditionField.options[conditionField.selectedIndex].text;
        }
    
        function previewImage() {
            const file = document.getElementById('id_image').files[0];
            const reader = new FileReader();
    
            reader.onloadend = function () {
                imgPreview.innerHTML = `<img src="${reader.result}" alt="Image preview" />`;
            }
    
            if (file) {
                reader.readAsDataURL(file);
            } else {
                imgPreview.innerHTML = `<span>No image uploaded yet.</span>`;
            }
        }
    
        // Event listeners
        titleField.addEventListener('input', updatePreview);
        priceField.addEventListener('input', updatePreview);
        authorField.addEventListener('input', updatePreview);
        conditionField.addEventListener('change', updatePreview);
        descriptionField.addEventListener('input', updatePreview);
        document.getElementById('id_image').addEventListener('change', previewImage); // <-- This line fixes it
    </script>
    
</body>
</html>
